1. Vérification des Partitions
lsblk (= lister les périphériques de bloc)

NAME : Le nom du périphérique ou de la partition.
MAJ : Les numéros majeurs et mineurs du périphérique.
RM : Indicateur de périphérique amovible (1 pour oui, 0 pour non).
SIZE : La taille du périphérique ou de la partition.
RO : Indicateur de lecture seule (1 pour oui, 0 pour non).
TYPE : Le type de périphérique (disk pour un disque dur, part pour une partition, lvm pour un volume logique, etc.).
MOUNTPOINT : Le point de montage où la partition est montée dans le système de fichiers.

Options Utiles
lsblk -f : Affiche les systèmes de fichiers des partitions.
lsblk -l : Affiche la sortie sous forme de liste plutôt que de tableau.
lsblk -o NAME,SIZE,FSTYPE,MOUNTPOINT : Affiche des colonnes spécifiques (nom, taille, type de système de fichiers, et point de montage).

Commandes Complémentaires
df -h : Affiche l'espace disque utilisé et disponible sur les systèmes de fichiers.
fdisk -l : Liste les tables de partition.
blkid : Affiche les identifiants des systèmes de fichiers et les types de systèmes de fichiers.

2. Configurating Your Virtual Machine
2.1. Installing Sudo

su -
su = (swich user) changer d'utilisateur dans un terminal.
Sans argument, elle change pour l'utilisateur root par défaut.
- : L'option - (ou --login) fait que l'environnement de l'utilisateur cible (ici root) est initialisé comme s'il s'agissait d'une nouvelle connexion. Cela inclut la mise à jour des variables d'environnement, le répertoire de travail et les chemins d'accès.
=> Effectuer des configurations nécessitant des privilèges administratifs (= effectuer des modifications critiques sur le système)
Cela peut inclure des tâches comme :
	Création et gestion de partitions.
	Configuration des services systèmes comme SSH, UFW (pare-feu), etc.
	Installation et configuration de logiciels.

apt-get update -y
apt-get update : Mettre à jour la liste des paquets disponibles (apt = Advanced Package Tool) dans les dépôts logiciels configurés sur votre système Debian.
=> votre système contacte les dépôts de logiciels configurés pour obtenir la liste actuelle des paquets disponibles.
Cette liste est ensuite stockée localement sur votre système pour que le gestionnaire de paquets puisse l'utiliser pour les futures opérations d'installation, de mise à niveau ou de suppression de logiciels.
Garantir la Fraîcheur des Informations : M'assure que votre système utilise les informations les plus récentes sur les paquets disponibles.
-y : L'option -y permet d'automatiser le processus de MaJ en répondant automatiquement "oui" à toutes les questions posées par la commande.
Cela est utile lorsque vous exécutez la commande dans un script ou lorsque vous voulez éviter les interruptions lors de la mise à jour régulière de votre système.

apt-get upgrade -y
Mettre à niveau tous les paquets installés sur votre système Debian vers leurs versions les plus récentes disponibles dans les dépôts logiciels configurés.
=> Mise à Jour des Paquets : Lorsque de nouvelles versions de logiciels sont disponibles dans les dépôts, apt-get upgrade met à jour les paquets installés sur votre système avec ces nouvelles versions.
Cela permet de garantir que votre système utilise les dernières fonctionnalités, correctifs de bugs et améliorations de sécurité.
Sécurité : Les mises à jour de sécurité sont souvent incluses dans les nouvelles versions des logiciels. En exécutant régulièrement apt-get upgrade, vous vous assurez que votre système est protégé contre les vulnérabilités connues.
Stabilité : Les mises à jour de logiciels peuvent également inclure des correctifs de bugs qui améliorent la stabilité et les performances de votre système.

apt install sudo
Installer le programme sudo sur votre système.
sudo (abréviation de "SuperUser Do")
=> permet à un utilisateur d'exécuter des commandes avec les privilèges d'un autre utilisateur, généralement l'utilisateur root.
nstaller sudo est généralement une étape importante lors de la configuration d'un nouveau système Linux, car cela permet de mettre en place un système d'administration sécurisé et de limiter l'utilisation directe du compte root, ce qui peut réduire les risques de sécurité.

usermod -aG sudo your_username    OU     adduser <username> sudo
usermod : commande utilisée pour modifier les attributs d'un utilisateur.
-aG sudo : option de la commande usermod qui ajoute l'utilisateur spécifié au groupe sudo.
-a signifie "append" (ajouter), et -G spécifie le groupe.
your_username : C'est le nom de l'utilisateur auquel vous souhaitez accorder des privilèges d'administration avec sudo.
=> l'utilisateur spécifié pourra utiliser sudo pour exécuter des commandes avec les privilèges d'administration. Cela permet de limiter l'utilisation directe du compte root, ce qui est généralement considéré comme une pratique plus sécurisée.

Commandes Complémentaires (pour verif)
dpkg -l | grep sudo : (Debian Package) Lister tous les paquets installés sur votre système | filtrer les résultats de la commande afin de ne montrer que les lignes qui contiennent le mot "sudo".
getent group sudo : Affiche les informations du groupe sudo.
groups your_username : Affiche les groupes auxquels appartient un utilisateur spécifique, y compris le groupe sudo s'il y est ajouté.

2.2. Installing and Configuring SSH (Secure Shell Host)
2.2.1 Installing
sudo apt install openssh-server
sudo : préfixe exécute la commande avec des privilèges administratifs (superutilisateur ou root). Cela est nécessaire car l'installation de logiciels affecte le système d'exploitation et nécessite des autorisations élevées.
apt : Il s'agit de l'outil de gestion de paquets pour les distributions Debian et basées sur Debian, comme Ubuntu. Il est utilisé pour gérer les paquets logiciels, c'est-à-dire les installer, les mettre à jour et les supprimer.
install : Ce sous-commande indique à apt que vous souhaitez installer un paquet logiciel.
openssh-server : nom du paquet que vous voulez installer.
"OpenSSH" est une suite de connectivité pour chiffrer les communications réseau en utilisant le protocole SSH, et "server" indique qu'il s'agit du composant serveur.
=> Télécharge le paquet openssh-server et ses dépendances à partir des dépôts de logiciels configurés.
Installe le paquet sur votre système.
Configure le serveur SSH pour qu'il puisse démarrer automatiquement avec le système et être prêt à accepter les connexions SSH.

sudo systemctl status ssh => check l'état actuel du service SSH
systemctl : commande qui contrôle le système init de Linux (systemd) qui est utilisé pour gérer les services et d'autres aspects du système, y compris le démarrage, l'arrêt et la vérification de l'état des services.
status : option de la commande systemctl qui indique que nous voulons vérifier l'état actuel du service spécifié.
ssh : C'est le nom du service pour lequel nous voulons obtenir l'état.

Commandes Complémentaires (pour verif):
dpkg -l | grep ssh : (Debian Package) vérifier si le package openssh-server (ou tout autre package lié à SSH) est bien installé sur votre système

installation de vim car chiant d'utiliser vi:
apt-get install vim -y

2.2.2 Config
sudo vim /etc/ssh/sshd_config
sudo : C'est une commande utilisée sous Unix et Linux pour exécuter des commandes avec les privilèges de superutilisateur (root). Elle permet d'exécuter vi avec des droits élevés nécessaires pour modifier des fichiers système comme /etc/ssh/sshd_config.
vim : C'est un éditeur de texte en mode terminal (= vim version -ameliore) très puissant et largement utilisé sous Unix et Linux. Il est connu pour sa flexibilité et ses fonctionnalités avancées, bien qu'il puisse être intimidant pour les utilisateurs novices.
/etc/ssh/sshd_config : C'est le chemin du fichier de configuration du démon SSH (sshd). Ce fichier contient les paramètres de configuration pour le service SSH sur votre système. Modifier ce fichier permet de personnaliser le comportement et les options de configuration du service SSH.

Changer #port22 en port 4242
Le # est utilisé pour commenter une ligne, ce qui signifie que la ligne est ignorée par le programme.
En retirant le #, vous activez la configuration du port 4242 pour SSH.

Changer #PermitRootLogin prohibit-password en PermitRootLogin no
pour modifier la conf SSH pour désactiver la connexion en tant que root

sudo systemctl restart ssh
sudo systemctl status ssh

2.2.3 - Installing and Configuring UFW (Uncomplicated Firewall)
apt-get install ufw => installe UFW OU sudo apt install ufw

ATTENTION LE PORT 22 est active
revenir dessus

sudo ufw enable pour desactiver UFW
sudo ufw status
sudo ufw allow ssh
sudo ufw allow 4242

2.2.4 - Connecting to Server via SSH
J'ai choisi methode : Connexion directe via adresse IP et port
Si ça fonctionne c’est mieux, cest plus portable
Là c'est une IP interne à ma machine. Le réseau ça fonctionne via IP que tu sois en interne à ta machine ou sur internet, comme ça tout fonctionne pareil.
Par contre oui ça changera à chaque démarrage de ta VM donc il faut savoir où la trouver
Une VM  a une IP propre. Mais qui n’est connue que de ta machine hôte (l’ordi sur lequel tu as démarré la VM)

ip a | grep inet  OU ip a show enp0s3 | grep inet
lo (loopback) : Utilisée pour la communication interne du système, IP 127.0.0.1.
enp0s3 (Ethernet) : Interface réseau utilisée pour les connexions externes, avec IP 10.0.2.15 dans votre cas.

ssh aumartin@127.0.0.1 -p 4242
ssh : Lance le client SSH pour se connecter à un serveur distant via le protocole SSH.
<username> : Remplacez <username> par votre nom d'utilisateur sur la VM.
-p 4242 : Spécifie que le port 4242 doit être utilisé pour la connexion SSH.

logout ou exit pour déconnecter et terminer la connexion SSH établie avec le serveur distant.

J'ai du faire un Port forwarding
ssh -L 4243:localhost:4242 aumartin@10.0.2.15
Justification pour l'utilisation du Port Forwarding

L'utilisation du port forwarding est justifiée dans votre cas car le port 4242 semble déjà utilisé ou bloqué sur votre réseau local. En redirigeant le port 4242 de votre machine virtuelle vers un autre port (comme 4243) sur votre machine hôte, vous contournez les problèmes de conflits de port et vous pouvez toujours accéder à votre machine virtuelle via SSH de manière sécurisée.

Tester la connexion a distance
Ouvrir un terminal (hote)
ssh aumartin@127.0.0.1 -p 4243
Si ca marche pas : rm ~/.ssh/known_hosts dans iTerm puis retape ssh aumartin@127.0.0.1 -p 4243


3. User Management

3.1 Mettre en place une politique de mot de passe fort

3.1.1 Password Age
sudo vi /etc/login.defs
=> ouvre le fichier /etc/login.defs en utilisant l'éditeur de texte vi avec des privilèges administratifs (sudo). Ce fichier contient les paramètres de configuration liés aux comptes d'utilisateurs sur le système Linux, notamment les règles de gestion des mots de passe comme la durée de validité, les avertissements de changement de mot de passe, etc.
tu changes les lignes dans la section Password aging controls
160 PASS_MAX_DAYS   30
161 PASS_MIN_DAYS   2
162 PASS_WARN_AGE   7

3.1.2 Password Strength
sudo apt install libpam-pwquality
libpam-pwquality: Ce paquet contient des modules PAM (Pluggable Authentication Modules) pour améliorer la sécurité des mots de passe en permettant de définir des politiques de force de mot de passe, comme la longueur minimale, les caractères requis, etc.
=> installer la bibliothèque de vérification de la qualité des mots de passe, libpam-pwquality, sur un système Linux

dpkg -l | grep libpam-pwquality

man pam_pwquality

sudo vi /etc/pam.d/common-password
=> ouvre le fichier common-password situé dans le répertoire /etc/pam.d/ en mode édition avec l'éditeur de texte vi.
Ce fichier est utilisé par le module PAM (Pluggable Authentication Modules) pour configurer les politiques de mot de passe communes pour différents services système.

ajouter des options a la ligne
password        requisite                       pam_pwquality.so retry=3
minlen=10 => len de 10 caracteres
ucredit=-1 dcredit=-1  => contenir au moins une lettre majuscule  ("uppercase credit") && ontenir au moins un chiffre (digit credit)
La valeur -1 signifie que cette exigence doit être respectée.
maxrepeat=3 => max 3 caractères consecutifs identiques
reject_username => rejeter contient le username
difok=7 => comporter au moins 7 caractères qui ne sont pas présents dans l’ancien mot de passe.
enforce_for_root => votre mot de passe root devra suivre cette politique.

sudo reboot => redémarrer votre système pour que ces modifications prennent effet de manière cohérente

3.2 Configuration du groupe sudoers
sudo visudo

* Defaults env_reset (deja presente default)
=> Cette option réinitialise l'environnement pour une commande exécutée via sudo. Cela signifie que l'environnement de l'utilisateur ne sera pas transféré à la commande exécutée avec sudo, assurant ainsi une isolation et une sécurité accrues.
* Defaults mail_badpass (deja presente default)
=> Lorsqu'un utilisateur entre un mot de passe incorrect lors de l'utilisation de sudo, une notification par courrier électronique est envoyée à l'administrateur système. Cela aide à surveiller et à détecter les tentatives d'utilisation non autorisée de sudo.
* Defaults secure_path="/usr/local/sbin:/usr/local/bin:/usr/bin:/sbin:/bin"
=> Cette option définit les chemins d'exécution sécurisés pour les commandes exécutées via sudo. Seules les commandes situées dans ces répertoires seront disponibles pour l'exécution via sudo, limitant ainsi les risques associés à l'exécution de commandes potentiellement malveillantes.
* Defaults badpass_message="Le mot de passe est incorrect, veuillez réessayer !"
=> message qui sera affiché à l'utilisateur si un mot de passe incorrect est entré lors de l'utilisation de sudo. Cela permet de fournir une rétroaction claire à l'utilisateur sur la raison de l'échec de l'authentification.
* Defaults passwd_tries=3
=> Cette option limite le nombre de tentatives autorisées pour entrer un mot de passe correct lors de l'utilisation de sudo. Après trois tentatives infructueuses, sudo refusera l'accès jusqu'à ce qu'une nouvelle session soit démarrée.
* Defaults logfile="/var/log/sudo/sudo.log" (=> journal unique)
=> pécifie le chemin du fichier journal dans lequel toutes les actions exécutées via sudo seront enregistrées. Cela permet une traçabilité complète des commandes exécutées avec sudo.
Pour un script comme monitoring.sh qui collecte diverses informations système à intervalles réguliers (toutes les 10 minutes), l'utilisation d'un fichier journal unique (sudo.log) pourrait être plus pratique et suffisante. Cela centralise les données et simplifie la maintenance et l'analyse.
* Defaults log_input, log_output
=> activent la journalisation des entrées (log_input) et des sorties (log_output) des commandes exécutées via sudo. Cela inclut les commandes entrées par l'utilisateur ainsi que leurs résultats.
* Defaults requiretty
Activation le mode TTY (Teletype) pour sudo
=> Cette option requiert qu'une console soit associée à la commande sudo pour qu'elle puisse être exécutée. Cela empêche l'exécution de commandes sudo à partir de scripts ou de processus sans terminal associé, ce qui ajoute une couche supplémentaire de sécurité.

options :
Defaults insults
Defaults passprompt="N'oubliez pas de sourire :)" : Cela modifie le message de prompt de mot de passe de sudo pour inclure une remarque amicale. C'est une façon subtile d'ajouter une touche personnelle.
Defaults lecture : Cette option affiche un message humoristique ou informatif à chaque utilisation de sudo. Cela peut ajouter un peu de légèretévirt à l'utilisation quotidienne de sudo.

Utilisez cd /var/log pour accéder au répertoire des journaux.
sudo mkdir /var/log/sudo
sudo touch /var/log/sudo/sudo.log


3.3 Changement des mots de passe existants
sudo passwd root
sudo passwd aumartin

3.4 Création d'un groupe
sudo addgroup user42
sudo groupadd evaluating

getent group => verifier group
OU groups

Ajouter un user au groupe
sudo adduser <username> user42
OU  sudo usermod -aG user42 <username>

getent group user42 => verif qui fait parti d'un groupe

3.5 Création d'un new user
cut -d: -f1 /etc/passwd =>  check all local users
sudo adduser <username>

getent passwd <username> => verifi si user bien cree

chage -l <username> => chek si regle mdp fonctionnent pour le user




EN PLUS j'ai Installer net-tools pour verifier les ports sur ma VM :

sudo apt update
sudo apt install net-tools


